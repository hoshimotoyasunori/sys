# 機能仕様書

## 1. 概要

### 1.1 目的
システム設計アシスタントの機能仕様を定義し、開発チームが実装すべき機能を明確化する。

### 1.2 対象システム
システム設計アシスタント（Webアプリケーション）

### 1.3 対象読者
- 開発チーム
- プロジェクトマネージャー
- 品質保証チーム

## 2. 認証・認可機能

### 2.1 ユーザー認証

#### 2.1.1 ログイン機能
**機能ID**: AUTH-001

**概要**: ユーザーがメールアドレスとパスワードでログインする

**入力**:
- メールアドレス（必須）
- パスワード（必須）

**処理**:
1. 入力値のバリデーション
2. Supabase Authによる認証
3. セッションの作成
4. ダッシュボードへのリダイレクト

**出力**:
- 成功時: ダッシュボード画面
- 失敗時: エラーメッセージ

**エラーハンドリング**:
- 無効なメールアドレス形式
- パスワードが短すぎる
- 認証失敗

#### 2.1.2 ログアウト機能
**機能ID**: AUTH-002

**概要**: ユーザーがログアウトする

**処理**:
1. セッションの破棄
2. ログイン画面へのリダイレクト

**出力**:
- ログイン画面

### 2.2 権限管理

#### 2.2.1 ロール定義
**機能ID**: AUTH-003

**概要**: プロジェクト内での権限を定義する

**ロール**:
- **オーナー**: プロジェクトの完全管理権限
  - プロジェクトの作成・編集・削除
  - メンバーの招待・削除
  - 権限の変更
- **管理者**: プロジェクトの編集権限
  - プロジェクトの編集
  - メンバーの招待
  - タスク・成果物の管理
- **メンバー**: プロジェクトの閲覧・編集権限
  - プロジェクトの閲覧
  - タスク・成果物の編集

## 3. プロジェクト管理機能

### 3.1 プロジェクト作成

#### 3.1.1 プロジェクト作成機能
**機能ID**: PROJ-001

**概要**: 新しいプロジェクトを作成する

**入力**:
- プロジェクト名（必須、最大100文字）
- プロジェクト説明（任意、最大500文字）

**処理**:
1. 入力値のバリデーション
2. プロジェクトの作成
3. 作成者をオーナーとして登録
4. 初期フェーズ・タスク・成果物の自動作成
5. プロジェクト選択状態に設定

**出力**:
- 成功時: プロジェクトダッシュボード
- 失敗時: エラーメッセージ

**初期データ**:
- 4つのフェーズ（要件定義、基本設計、外部設計、開発準備）
- 各フェーズの標準タスク
- 各フェーズの標準成果物

### 3.2 プロジェクト編集

#### 3.2.1 プロジェクト情報編集機能
**機能ID**: PROJ-002

**概要**: プロジェクトの基本情報を編集する

**権限**: オーナーのみ

**入力**:
- プロジェクト名（必須、最大100文字）
- プロジェクト説明（任意、最大500文字）

**処理**:
1. 権限チェック
2. 入力値のバリデーション
3. プロジェクト情報の更新
4. リアルタイム同期

**出力**:
- 成功時: 更新されたプロジェクト情報
- 失敗時: エラーメッセージ

### 3.3 プロジェクト削除

#### 3.3.1 プロジェクト削除機能
**機能ID**: PROJ-003

**概要**: プロジェクトを削除する

**権限**: オーナーのみ

**処理**:
1. 権限チェック
2. 確認ダイアログの表示
3. 関連データの削除
   - プロジェクトメンバー
   - プロジェクト招待
   - フェーズ
   - タスク
   - 成果物
4. プロジェクトの削除
5. プロジェクト選択画面へのリダイレクト

**出力**:
- 成功時: プロジェクト選択画面
- 失敗時: エラーメッセージ

### 3.4 プロジェクト切り替え

#### 3.4.1 プロジェクト選択機能
**機能ID**: PROJ-004

**概要**: 参加しているプロジェクト間を切り替える

**入力**:
- プロジェクト選択

**処理**:
1. 参加プロジェクト一覧の取得
2. プロジェクト選択
3. プロジェクトデータの読み込み
4. ダッシュボードの表示

**出力**:
- 選択されたプロジェクトのダッシュボード

## 4. メンバー管理機能

### 4.1 メンバー招待

#### 4.1.1 メンバー招待機能
**機能ID**: MEMB-001

**概要**: プロジェクトにメンバーを招待する

**権限**: オーナー、管理者

**入力**:
- メールアドレス（必須）

**処理**:
1. 権限チェック
2. メールアドレスのバリデーション
3. 招待レコードの作成
4. 招待メールの送信
5. 招待状態の管理

**出力**:
- 成功時: 招待完了メッセージ
- 失敗時: エラーメッセージ

**招待メール内容**:
- プロジェクト名
- 招待者の名前
- 招待リンク
- 招待の受け入れ・辞退ボタン

### 4.2 招待受け入れ

#### 4.2.1 招待受け入れ機能
**機能ID**: MEMB-002

**概要**: プロジェクト招待を受け入れる

**入力**:
- 招待トークン

**処理**:
1. 招待トークンの検証
2. 招待状態の確認
3. プロジェクトメンバーとして登録
4. 招待状態を「accepted」に更新
5. プロジェクトダッシュボードへのリダイレクト

**出力**:
- 成功時: プロジェクトダッシュボード
- 失敗時: エラーメッセージ

### 4.3 メンバー管理

#### 4.3.1 メンバー一覧表示機能
**機能ID**: MEMB-003

**概要**: プロジェクトメンバーの一覧を表示する

**処理**:
1. プロジェクトメンバーの取得
2. メンバー情報の表示
   - 名前
   - メールアドレス
   - 権限
   - 参加日

**出力**:
- メンバー一覧

#### 4.3.2 メンバー権限変更機能
**機能ID**: MEMB-004

**概要**: メンバーの権限を変更する

**権限**: オーナーのみ

**入力**:
- メンバーID
- 新しい権限

**処理**:
1. 権限チェック
2. メンバー権限の更新
3. リアルタイム同期

**出力**:
- 成功時: 更新されたメンバー情報
- 失敗時: エラーメッセージ

#### 4.3.3 メンバー削除機能
**機能ID**: MEMB-005

**概要**: プロジェクトからメンバーを削除する

**権限**: オーナーのみ

**入力**:
- メンバーID

**処理**:
1. 権限チェック
2. 確認ダイアログの表示
3. メンバーの削除
4. リアルタイム同期

**出力**:
- 成功時: 更新されたメンバー一覧
- 失敗時: エラーメッセージ

## 5. タスク管理機能

### 5.1 タスク表示

#### 5.1.1 フェーズ別タスク表示機能
**機能ID**: TASK-001

**概要**: フェーズ別にタスクを表示する

**処理**:
1. プロジェクトのフェーズ取得
2. 各フェーズのタスク取得
3. order_indexによるソート
4. タスク一覧の表示

**表示項目**:
- タスクタイトル
- 完了状態（チェックボックス）
- フェーズ名

**出力**:
- フェーズ別タスク一覧

### 5.2 タスク更新

#### 5.2.1 タスク完了状態更新機能
**機能ID**: TASK-002

**概要**: タスクの完了状態を更新する

**入力**:
- タスクID
- 完了状態（true/false）

**処理**:
1. タスクの完了状態更新
2. ローカル状態の更新
3. order_indexによるソート維持
4. リアルタイム同期

**出力**:
- 成功時: 更新されたタスク情報
- 失敗時: エラーメッセージ

**制約**:
- タスクの順序は変更されない（order_index固定）

## 6. 成果物管理機能

### 6.1 成果物表示

#### 6.1.1 フェーズ別成果物表示機能
**機能ID**: DELV-001

**概要**: フェーズ別に成果物を表示する

**処理**:
1. プロジェクトのフェーズ取得
2. 各フェーズの成果物取得
3. order_indexによるソート
4. 成果物一覧の表示

**表示項目**:
- 成果物名
- ステータス（未着手、進行中、完了）
- フェーズ名

**出力**:
- フェーズ別成果物一覧

### 6.2 成果物更新

#### 6.2.1 成果物ステータス更新機能
**機能ID**: DELV-002

**概要**: 成果物のステータスを更新する

**入力**:
- 成果物ID
- 新しいステータス

**処理**:
1. 成果物のステータス更新
2. ローカル状態の更新
3. order_indexによるソート維持
4. リアルタイム同期

**出力**:
- 成功時: 更新された成果物情報
- 失敗時: エラーメッセージ

**ステータス**:
- 未着手
- 進行中
- 完了

## 7. フェーズ管理機能

### 7.1 フェーズ表示

#### 7.1.1 フェーズ一覧表示機能
**機能ID**: PHASE-001

**概要**: プロジェクトのフェーズ一覧を表示する

**処理**:
1. プロジェクトのフェーズ取得
2. order_indexによるソート
3. フェーズ一覧の表示

**表示項目**:
- フェーズ名
- 進捗状況
- タスク数
- 成果物数

**出力**:
- フェーズ一覧

#### 7.1.2 フェーズ概要表示機能
**機能ID**: PHASE-002

**概要**: フェーズの概要情報を表示する

**処理**:
1. フェーズ情報の取得
2. フェーズ内のタスク・成果物統計
3. 進捗率の計算
4. 概要情報の表示

**表示項目**:
- フェーズ名
- 進捗率
- 完了タスク数/総タスク数
- 完了成果物数/総成果物数

**出力**:
- フェーズ概要

## 8. リアルタイム同期機能

### 8.1 データ同期

#### 8.1.1 リアルタイムデータ更新機能
**機能ID**: SYNC-001

**概要**: プロジェクトデータのリアルタイム同期を行う

**処理**:
1. Supabase Realtimeの購読設定
2. データ変更の監視
3. ローカル状態の更新
4. UIの再レンダリング

**監視対象**:
- タスク
- 成果物
- プロジェクトメンバー
- プロジェクト情報

**出力**:
- リアルタイム更新されたデータ

### 8.2 競合解決

#### 8.2.1 競合解決機能
**機能ID**: SYNC-002

**概要**: 同時編集による競合を解決する

**処理**:
1. 競合の検出
2. 最新データの取得
3. ローカル状態の更新
4. ユーザーへの通知

**出力**:
- 競合解決後のデータ
- 競合通知メッセージ

## 9. UI/UX機能

### 9.1 レスポンシブデザイン

#### 9.1.1 モバイル対応機能
**機能ID**: UI-001

**概要**: モバイルデバイスに対応したUIを提供する

**対応デバイス**:
- スマートフォン（320px以上）
- タブレット（768px以上）
- デスクトップ（1024px以上）

**処理**:
1. デバイスサイズの検出
2. レスポンシブレイアウトの適用
3. タッチ操作の最適化

**出力**:
- デバイスに最適化されたUI

### 9.2 エラーハンドリング

#### 9.2.1 エラー表示機能
**機能ID**: UI-002

**概要**: エラーを適切に表示する

**処理**:
1. エラーの検出
2. エラーメッセージの生成
3. ユーザーフレンドリーな表示
4. エラー解決のガイダンス提供

**出力**:
- エラーメッセージ
- 解決方法の提案

### 9.3 ローディング表示

#### 9.3.1 ローディング表示機能
**機能ID**: UI-003

**概要**: データ読み込み中の表示を行う

**処理**:
1. データ読み込み状態の検出
2. ローディングインジケーターの表示
3. 読み込み完了後の非表示

**出力**:
- ローディングインジケーター

## 10. パフォーマンス機能

### 10.1 データ最適化

#### 10.1.1 データキャッシュ機能
**機能ID**: PERF-001

**概要**: データのキャッシュを行い、パフォーマンスを向上させる

**処理**:
1. データのキャッシュ
2. キャッシュの有効期限管理
3. 不要データの削除
4. キャッシュヒット率の最適化

**出力**:
- キャッシュされたデータ

### 10.2 遅延読み込み

#### 10.2.1 遅延読み込み機能
**機能ID**: PERF-002

**概要**: 必要なデータのみを遅延読み込みする

**処理**:
1. 表示範囲の検出
2. 必要なデータの特定
3. 段階的なデータ読み込み
4. 読み込み完了の通知

**出力**:
- 段階的に読み込まれたデータ 